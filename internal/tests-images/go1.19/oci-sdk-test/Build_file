ARG GO_VERSION=latest
ARG OCIR_REGION=OCIR_REGION
ARG OCIR_LOC=OCIR_LOC
ARG BUILD_VERSION=BUILD_VERSION

FROM ${OCIR_REGION}/${OCIR_LOC}/gofdk:${GO_VERSION}-${BUILD_VERSION}-dev as build-stage
WORKDIR /function
WORKDIR /go/src/func/
ENV GO111MODULE=on
COPY . .
RUN go mod tidy
RUN go mod vendor
RUN go build -o func -v
FROM ${OCIR_REGION}/${OCIR_LOC}/gofdk:${GO_VERSION}-${BUILD_VERSION}
WORKDIR /function
COPY --from=build-stage /go/src/func/func /function/
ENTRYPOINT ["./func"]
